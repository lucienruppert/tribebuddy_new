<div
  *ngIf="sessionId"
  class="w-full min-h-screen flex items-center justify-center pt-2 pb-10"
>
  <div class="relative aspect-square w-[min(95vh,98vw)]">
    <svg
      class="absolute inset-0 w-full h-full"
      viewBox="0 0 800 800"
      preserveAspectRatio="xMidYMid meet"
    >
      <defs>
        <!-- Enhanced gradients for all colors -->
        <radialGradient
          id="redGradient"
          cx="40%"
          cy="40%"
          r="65%"
          fx="25%"
          fy="25%"
        >
          <stop offset="0%" style="stop-color: #f87171; stop-opacity: 1" />
          <stop offset="45%" style="stop-color: #dc2626; stop-opacity: 1" />
          <stop offset="75%" style="stop-color: #b91c1c; stop-opacity: 1" />
          <stop offset="100%" style="stop-color: #991b1b; stop-opacity: 1" />
        </radialGradient>

        <radialGradient
          id="blueGradient"
          cx="40%"
          cy="40%"
          r="65%"
          fx="25%"
          fy="25%"
        >
          <stop offset="0%" style="stop-color: #60a5fa; stop-opacity: 1" />
          <stop offset="45%" style="stop-color: #2563eb; stop-opacity: 1" />
          <stop offset="75%" style="stop-color: #1d4ed8; stop-opacity: 1" />
          <stop offset="100%" style="stop-color: #1e40af; stop-opacity: 1" />
        </radialGradient>

        <radialGradient
          id="tealGradient"
          cx="40%"
          cy="40%"
          r="65%"
          fx="25%"
          fy="25%"
        >
          <stop offset="0%" style="stop-color: #14b8a6; stop-opacity: 1" />
          <stop offset="45%" style="stop-color: #0d9488; stop-opacity: 1" />
          <stop offset="75%" style="stop-color: #0f766e; stop-opacity: 1" />
          <stop offset="100%" style="stop-color: #134e4a; stop-opacity: 1" />
        </radialGradient>

        <!-- Shine effects -->
        <linearGradient id="shine" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color: #ffffff; stop-opacity: 0.3" />
          <stop offset="50%" style="stop-color: #ffffff; stop-opacity: 0" />
          <stop offset="100%" style="stop-color: #ffffff; stop-opacity: 0" />
        </linearGradient>

        <!-- Refined shadow effect -->
        <filter id="dropShadow" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur in="SourceAlpha" stdDeviation="5" />
          <feOffset dx="4" dy="4" result="offsetblur" />
          <feFlood flood-color="black" flood-opacity="0.3" />
          <feComposite in2="offsetblur" operator="in" />
          <feMerge>
            <feMergeNode />
            <feMergeNode in="SourceGraphic" />
          </feMerge>
        </filter>

        <!-- Simplified single clip path with explicit viewBox -->
        <clipPath id="roundedCardCorners">
          <rect width="96" height="130" rx="8" ry="8" />
        </clipPath>
      </defs>

      <!-- Outer circle rendered as small lines -->
      @for (line of outerCircleLines; track $index) {
        <line
          [attr.x1]="400 + radius * Math.cos(($index * 5 * Math.PI) / 180)"
          [attr.y1]="400 + radius * Math.sin(($index * 5 * Math.PI) / 180)"
          [attr.x2]="
            400 + radius * Math.cos((($index * 5 + 4) * Math.PI) / 180)
          "
          [attr.y2]="
            400 + radius * Math.sin((($index * 5 + 4) * Math.PI) / 180)
          "
          class="stroke-gray-900"
          stroke-width="40"
        />
      }

      <!-- Line connections section -->
      <!-- Line between top edge and Tennivalód az életben -->
      <line
        x1="400"
        y1="50"
        x2="400"
        y2="250"
        class="stroke-blue-500 opacity-75"
        stroke-width="2"
        style="filter: url(#lineGlow)"
      />
      <!-- Line between Életcélod and bottom edge -->
      <line
        x1="400"
        y1="550"
        x2="400"
        y2="750"
        class="stroke-red-500 opacity-75"
        stroke-width="2"
        style="filter: url(#lineGlow)"
      />
      <!-- Line between Ragyogásod and Fejlődésed útja -->
      <line
        x1="50"
        y1="400"
        x2="300"
        y2="400"
        class="stroke-teal-500 opacity-75"
        stroke-width="2"
        style="filter: url(#lineGlow)"
      />
      <line
        x1="300"
        y1="400"
        x2="500"
        y2="400"
        class="stroke-red-500 opacity-75"
        stroke-width="2"
        style="filter: url(#lineGlow)"
      />
      <line
        x1="500"
        y1="400"
        x2="750"
        y2="400"
        class="stroke-teal-500 opacity-75"
        stroke-width="2"
        style="filter: url(#lineGlow)"
      />

      <!-- Line between Mag/Hivatás and SQ and EQ -->
      <line
        [attr.x1]="400 - radius * 0.5 * 0.866"
        [attr.y1]="400 - radius * 0.5 * 0.5"
        [attr.x2]="400 + radius * 0.5 * 0.866"
        [attr.y2]="400 + radius * 0.5 * 0.5"
        class="stroke-red-500 opacity-75"
        stroke-width="2"
        style="filter: url(#lineGlow)"
      />
      <!-- Line between IQ and EQ -->
      <line
        [attr.x1]="400 - radius * 0.5 * 0.866"
        [attr.y1]="400 + radius * 0.5 * 0.5"
        [attr.x2]="400 + radius * 0.5 * 0.866"
        [attr.y2]="400 + radius * 0.5 * 0.5"
        class="stroke-red-500 opacity-75"
        stroke-width="2"
        style="filter: url(#lineGlow)"
      />
      <!-- Line between IQ and Vonzásmeződ -->
      <line
        [attr.x1]="400 - radius * 0.5 * 0.866"
        [attr.y1]="400 + radius * 0.5 * 0.5"
        [attr.x2]="400"
        [attr.y2]="400 + radius * 0.5"
        class="stroke-red-500 opacity-75"
        stroke-width="2"
        style="filter: url(#lineGlow)"
      />
      <!-- Line between Ragyogásod and Életcélod -->
      <line
        [attr.x1]="400 - radius"
        y1="400"
        x2="400"
        [attr.y2]="400 + radius"
        class="stroke-teal-500 opacity-75"
        stroke-width="2"
        style="filter: url(#lineGlow)"
      />
      <!-- Line between Mag/Hivatás and Kultúra -->
      <line
        [attr.x1]="400 - radius * 0.5 * 0.866"
        [attr.y1]="400 - radius * 0.5 * 0.5"
        [attr.x2]="400 + radius * 0.5 * 0.866"
        [attr.y2]="400 - radius * 0.5 * 0.5"
        class="stroke-blue-500 opacity-75"
        stroke-width="2"
        style="filter: url(#lineGlow)"
      />
      <!-- Line between Mag/Hivatás and Gyöngy -->
      <line
        [attr.x1]="400 - radius * 0.5 * 0.866"
        [attr.y1]="400 - radius * 0.5 * 0.5"
        x2="400"
        [attr.y2]="400 - radius * 0.5"
        class="stroke-blue-500 opacity-75"
        stroke-width="2"
        style="filter: url(#lineGlow)"
      />
      <!-- Line between Mag/Hivatás and Tennivalód az életben -->
      <line
        [attr.x1]="400 - radius * 0.5 * 0.866"
        [attr.y1]="400 - radius * 0.5 * 0.5"
        x2="400"
        [attr.y2]="400 - radius"
        class="stroke-blue-500 opacity-75"
        stroke-width="2"
        style="filter: url(#lineGlow)"
      />
      <!-- Line between Kultúra and Tennivalód az életben -->
      <line
        [attr.x1]="400 + radius * 0.5 * 0.866"
        [attr.y1]="400 - radius * 0.5 * 0.5"
        x2="400"
        [attr.y2]="400 - radius"
        class="stroke-blue-500 opacity-75"
        stroke-width="2"
        style="filter: url(#lineGlow)"
      />
      <!-- Line between Kultúra and Gyöngy -->
      <line
        [attr.x1]="400 + radius * 0.5 * 0.866"
        [attr.y1]="400 - radius * 0.5 * 0.5"
        x2="400"
        [attr.y2]="400 - radius * 0.5"
        class="stroke-blue-500 opacity-75"
        stroke-width="2"
        style="filter: url(#lineGlow)"
      />

      <!-- Line between Fejlődésed útja and Tennivalód az életben -->
      <line
        [attr.x1]="400 + radius"
        y1="400"
        x2="400"
        [attr.y2]="400 - radius"
        class="stroke-teal-500 opacity-75"
        stroke-width="2"
        style="filter: url(#lineGlow)"
      />

      <!-- Spots section with gradients -->
      <!-- Spot for Fejlődésed útja -->
      <g filter="url(#dropShadow)">
        <circle
          [attr.cx]="400 + radius"
          cy="400"
          r="40"
          style="fill: url(#tealGradient)"
        />
        <circle
          [attr.cx]="400 + radius"
          cy="400"
          r="40"
          style="fill: url(#shine)"
        />
      </g>

      <!-- Split spot for Tennivalód az életben -->
      <g
        [attr.transform]="'translate(400,' + (400 - radius) + ') rotate(180)'"
        filter="url(#dropShadow)"
      >
        <path
          d="M-27,-27 L27,27 A27,27 0 1,1 -27,-27"
          style="fill: url(#tealGradient)"
        />
        <path
          d="M-27,-27 L27,27 A27,27 0 1,0 -27,-27"
          style="fill: url(#blueGradient)"
        />
        <path
          d="M-27,-27 L27,27 A27,27 0 1,1 -27,-27"
          style="fill: url(#shine)"
        />
      </g>

      <!-- Spot for SQ (center) -->
      <g filter="url(#dropShadow)">
        <circle cx="400" cy="400" r="40" style="fill: url(#redGradient)" />
        <circle cx="400" cy="400" r="40" style="fill: url(#shine)" />
      </g>

      <!-- Spot for Ragyogásod -->
      <g filter="url(#dropShadow)">
        <circle
          [attr.cx]="400 - radius"
          cy="400"
          r="40"
          style="fill: url(#tealGradient)"
        />
        <circle
          [attr.cx]="400 - radius"
          cy="400"
          r="40"
          style="fill: url(#shine)"
        />
      </g>

      <!-- Spot for EQ -->
      <g filter="url(#dropShadow)">
        <circle
          [attr.cx]="400 + radius * 0.5 * 0.866"
          [attr.cy]="400 + radius * 0.5 * 0.5"
          r="40"
          style="fill: url(#redGradient)"
        />
        <circle
          [attr.cx]="400 + radius * 0.5 * 0.866"
          [attr.cy]="400 + radius * 0.5 * 0.5"
          r="40"
          style="fill: url(#shine)"
        />
      </g>

      <!-- Spot for IQ -->
      <g filter="url(#dropShadow)">
        <circle
          [attr.cx]="400 - radius * 0.5 * 0.866"
          [attr.cy]="400 + radius * 0.5 * 0.5"
          r="40"
          style="fill: url(#redGradient)"
        />
        <circle
          [attr.cx]="400 - radius * 0.5 * 0.866"
          [attr.cy]="400 + radius * 0.5 * 0.5"
          r="40"
          style="fill: url(#shine)"
        />
      </g>

      <!-- Split spot for Mag/Hivatás -->
      <g
        [attr.transform]="
          'translate(' +
          (400 - radius * 0.5 * 0.866) +
          ',' +
          (400 - radius * 0.5 * 0.5) +
          ') rotate(165)'
        "
        filter="url(#dropShadow)"
      >
        <path
          d="M-27,-27 L27,27 A27,27 0 1,1 -27,-27"
          style="fill: url(#redGradient)"
        />
        <path
          d="M-27,-27 L27,27 A27,27 0 1,0 -27,-27"
          style="fill: url(#blueGradient)"
        />
        <path
          d="M-27,-27 L27,27 A27,27 0 1,1 -27,-27"
          style="fill: url(#shine)"
        />
      </g>

      <!-- Spot for Kultúra -->
      <g filter="url(#dropShadow)">
        <circle
          [attr.cx]="400 + radius * 0.5 * 0.866"
          [attr.cy]="400 - radius * 0.5 * 0.5"
          r="40"
          style="fill: url(#blueGradient)"
        />
        <circle
          [attr.cx]="400 + radius * 0.5 * 0.866"
          [attr.cy]="400 - radius * 0.5 * 0.5"
          r="40"
          style="fill: url(#shine)"
        />
      </g>

      <!-- Gyöngy spot -->
      <g filter="url(#dropShadow)">
        <circle
          cx="400"
          [attr.cy]="400 - radius * 0.5"
          r="40"
          style="fill: url(#blueGradient)"
        />
        <circle
          cx="400"
          [attr.cy]="400 - radius * 0.5"
          r="40"
          style="fill: url(#shine)"
        />
      </g>

      <!-- Spot for Vonzásmeződ -->
      <g filter="url(#dropShadow)">
        <circle
          cx="400"
          [attr.cy]="400 + radius * 0.5"
          r="40"
          style="fill: url(#redGradient)"
        />
        <circle
          cx="400"
          [attr.cy]="400 + radius * 0.5"
          r="40"
          style="fill: url(#shine)"
        />
      </g>

      <!-- Bottom split spot -->
      <g
        [attr.transform]="'translate(400,' + (400 + radius) + ')'"
        filter="url(#dropShadow)"
      >
        <path
          d="M-27,-27 L27,27 A27,27 0 1,1 -27,-27"
          style="fill: url(#tealGradient)"
        />
        <path
          d="M-27,-27 L27,27 A27,27 0 1,0 -27,-27"
          style="fill: url(#redGradient)"
        />
        <path
          d="M-27,-27 L27,27 A27,27 0 1,1 -27,-27"
          style="fill: url(#shine)"
        />
      </g>

      <!-- Text labels section -->
      <!-- Label for Fejlődésed útja -->
      <text
        [attr.x]="400 + radius"
        y="400"
        class="text-xs fill-white"
        text-anchor="middle"
        dominant-baseline="middle"
      >
        <tspan [attr.x]="400 + radius" dy="-0.6em">Fejlődésed</tspan>
        <tspan [attr.x]="400 + radius" dy="1.2em">útja</tspan>
      </text>
      <!-- Label for Ragyogásod -->
      <text
        [attr.x]="400 - radius"
        y="400"
        class="text-xs fill-white"
        text-anchor="middle"
        dominant-baseline="middle"
      >
        Ragyogásod
      </text>
      <!-- Label for Tennivalód az életben -->
      <text
        x="400"
        [attr.y]="400 - radius"
        class="text-xs fill-white"
        text-anchor="middle"
        dominant-baseline="middle"
      >
        <tspan x="400" dy="-0.6em">Tennivalód</tspan>
        <tspan x="400" dy="1.2em">az</tspan>
        <tspan x="400" dy="1.2em">életben</tspan>
      </text>
      <!-- Label for EQ -->
      <text
        [attr.x]="400 + radius * 0.5 * 0.866"
        [attr.y]="400 + radius * 0.5 * 0.5"
        class="text-xs fill-white"
        text-anchor="middle"
        dominant-baseline="middle"
      >
        EQ
      </text>
      <!-- Label for IQ -->
      <text
        [attr.x]="400 - radius * 0.5 * 0.866"
        [attr.y]="400 + radius * 0.5 * 0.5"
        class="text-xs fill-white"
        text-anchor="middle"
        dominant-baseline="middle"
      >
        IQ
      </text>
      <!-- Label for Mag/Hivatás -->
      <text
        [attr.x]="400 - radius * 0.5 * 0.866"
        [attr.y]="400 - radius * 0.5 * 0.5"
        class="text-xs fill-white"
        text-anchor="middle"
        dominant-baseline="middle"
      >
        <tspan [attr.x]="400 - radius * 0.5 * 0.866" dy="-0.6em">Mag/</tspan>
        <tspan [attr.x]="400 - radius * 0.5 * 0.866" dy="1.2em">Hivatás</tspan>
      </text>
      <!-- Label for Kultúra -->
      <text
        [attr.x]="400 + radius * 0.5 * 0.866"
        [attr.y]="400 - radius * 0.5 * 0.5"
        class="text-xs fill-white"
        text-anchor="middle"
        dominant-baseline="middle"
      >
        Kultúra
      </text>
      <!-- Label for SQ -->
      <text
        x="400"
        y="400"
        class="text-xs fill-white"
        text-anchor="middle"
        dominant-baseline="middle"
      >
        SQ
      </text>
      <!-- Label for Gyöngy -->
      <text
        x="400"
        [attr.y]="400 - radius * 0.5"
        class="text-xs fill-white"
        text-anchor="middle"
        dominant-baseline="middle"
      >
        Gyöngy
      </text>
      <!-- Label for Vonzásmeződ -->
      <text
        x="400"
        [attr.y]="400 + radius * 0.5"
        class="text-xs fill-white"
        text-anchor="middle"
        dominant-baseline="middle"
      >
        <tspan x="400" dy="-0.6em">Vonzás-</tspan>
        <tspan x="400" dy="1.2em">meződ</tspan>
      </text>

      <!-- Bottom split spot with exactly half size (20px) -->
      <g
        [attr.transform]="'translate(400,' + (400 + radius) + ')'"
        filter="url(#dropShadow)"
      >
        <path
          d="M-27,-27 L27,27 A27,27 0 1,1 -27,-27"
          style="fill: url(#tealGradient)"
        />
        <path
          d="M-27,-27 L27,27 A27,27 0 1,0 -27,-27"
          style="fill: url(#redGradient)"
        />
        <path
          d="M-27,-27 L27,27 A27,27 0 1,1 -27,-27"
          style="fill: url(#shine)"
        />
      </g>

      <!-- Label for Életcélod -->
      <text
        x="400"
        [attr.y]="400 + radius"
        class="text-xs fill-white"
        text-anchor="middle"
        dominant-baseline="middle"
      >
        Életcélod
      </text>

      <!-- Card Images -->
      @for (position of cardPositions; track position.name) {
        @if (onChart[position.name]) {
          <!-- Wrapper group with translation -->
          <g
            [attr.transform]="
              'translate(' + position.x + ',' + position.y + ')'
            "
          >
            <!-- Create a masked group for all card content -->
            <g clip-path="url(#roundedCardCorners)">
              <!-- The card image -->
              <image
                [attr.href]="
                  'https://tribebuddy.com/cards/wisdomKeepers/' +
                  onChart[position.name] +
                  '.jpg'
                "
                width="96"
                height="130"
                preserveAspectRatio="xMidYMid slice"
              />

              <!-- Text background inside the clip path -->
              <rect
                x="0"
                y="106"
                width="96"
                height="24"
                fill="rgba(0,0,0,0.7)"
              />

              <!-- Text overlay also inside clip path -->
              <text
                x="48"
                y="122"
                class="text-sm font-medium fill-white"
                text-anchor="middle"
                dominant-baseline="middle"
              >
                {{ position.name }}
              </text>
            </g>
          </g>
        }
      }
    </svg>
  </div>
</div>
